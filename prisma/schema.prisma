generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Bank {
  id           String        @id @default(cuid())
  name         String
  emailFilter  String
  statementDay Int
  dueDay       Int?          // Due day for credit cards (1-31), null for debit
  bankType     String        @default("debit") // "debit" or "credit"
  color        String        @default("#3B82F6")
  parserType   String        @default("generic")
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  transactions Transaction[]
}

model Transaction {
  id               String   @id @default(cuid())
  bankId           String
  bank             Bank     @relation(fields: [bankId], references: [id], onDelete: Cascade)
  emailId          String?
  rawContent       String
  transactionType  String   @default("Unknown")
  amount           Float
  currency         String
  idrAmount        Float?
  merchant         String
  category         String
  date             DateTime
  installmentTerms Int?     // null or 1 = full payment, 3/6/12/24 = installment terms
  notes            String?  @db.VarChar(25) // Short notes, max 25 chars
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([bankId])
  @@index([date])
}

model Rule {
  id             String  @id @default(cuid())
  condition      String  // "contains", "startsWith", "endsWith", "equals"
  conditionValue String
  category       String
  priority       Int     @default(0)
  bankType       String? // null = all banks, "debit" or "credit" = specific type only
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Category {
  id        String   @id @default(cuid())
  name      String   @unique
  color     String   @default("#6B7280")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SyncLog {
  id        String   @id @default(cuid())
  bankId    String
  syncedAt  DateTime @default(now())
  emailCount Int
}

model Settings {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
